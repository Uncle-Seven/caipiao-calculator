<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>åŒè‰²çƒå¤å¼ä¸­å¥–æé€ŸæŸ¥è¯¢</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    
    <!-- ğŸŒŸ è¿™é‡Œå¼•å…¥ä½ è½¬æ¢å¥½çš„å¤–éƒ¨ JS æ•°æ®æ–‡ä»¶ ğŸŒŸ -->
    <script src="./ssq_data.js"></script> 
    <!-- çº¿ä¸Šéƒ¨ç½²æ—¶æ¢æˆç±»ä¼¼: <script src="https://ä½ çš„æœåŠ¡å™¨.com/ssq_data.js"></script> -->

    <style>
        .ball {
            display: inline-flex; justify-content: center; align-items: center;
            border-radius: 50%; color: white; font-weight: bold;
        }
        .red-ball { background: radial-gradient(circle at 30% 30%, #ff6b6b, #c0392b); box-shadow: 0 2px 4px rgba(192,57,43,0.4); }
        .blue-ball { background: radial-gradient(circle at 30% 30%, #4facfe, #00f2fe); box-shadow: 0 2px 4px rgba(0,242,254,0.4); }
        input[type="file"] { display: none; }
        * { -webkit-tap-highlight-color: transparent; }
    </style>
</head>
<body class="bg-gray-100 min-h-screen p-2 sm:p-4 md:p-8 text-gray-800">

<!-- æ¨¡æ¿ï¼šä¸­å¥–ç»“æœå¡ç‰‡ -->
<template id="result-template">
    <div :class="['bg-white rounded-xl md:rounded-2xl shadow-md p-4 md:p-6 border-t-4', themeClass]">
        <h2 class="text-xl md:text-2xl font-bold text-center mb-4 md:mb-6 text-gray-800">{{ title }}</h2>
        <div class="grid md:grid-cols-2 gap-4 md:gap-6 mb-6">
            <div class="bg-gray-50 p-3 md:p-4 rounded-xl border border-gray-200">
                <h3 class="text-sm md:text-base font-bold text-gray-600 mb-2 md:mb-3">æ‚¨çš„æŠ•æ³¨æ–¹æ¡ˆ</h3>
                <div class="flex flex-wrap gap-1.5 md:gap-2 mb-3">
                    <span v-for="r in parsedReds" class="ball red-ball w-7 h-7 md:w-9 md:h-9 text-xs md:text-sm">{{ r < 10 ? '0'+r : r }}</span>
                    <span v-for="b in parsedBlues" class="ball blue-ball w-7 h-7 md:w-9 md:h-9 text-xs md:text-sm">{{ b < 10 ? '0'+b : b }}</span>
                </div>
                <div class="flex justify-between text-xs md:text-sm text-gray-600">
                    <p>æ€»æ³¨æ•°ï¼š<span class="font-bold text-black">{{ formatMoney(totalBets) }}</span> æ³¨</p>
                    <p>æˆæœ¬ï¼š<span class="font-bold text-red-600">ï¿¥{{ formatMoney(totalBets * 2) }}</span></p>
                </div>
            </div>
            <div class="bg-gray-50 p-3 md:p-4 rounded-xl border border-gray-200">
                <h3 class="text-sm md:text-base font-bold text-gray-600 mb-2 md:mb-3">
                    ç¬¬ <span class="text-red-600">{{ result.draw.issue }}</span> æœŸå¼€å¥– 
                    <span class="text-xs font-normal text-gray-400 block sm:inline">({{ result.draw.date }})</span>
                </h3>
                <div class="flex flex-wrap gap-1.5 md:gap-2 mb-3">
                    <span v-for="r in result.draw.reds" :class="['ball w-7 h-7 md:w-9 md:h-9 text-xs md:text-sm', parsedReds.includes(r) ? 'red-ball' : 'bg-gray-300']">{{ r < 10 ? '0'+r : r }}</span>
                    <span :class="['ball w-7 h-7 md:w-9 md:h-9 text-xs md:text-sm', parsedBlues.includes(result.draw.blue) ? 'blue-ball' : 'bg-gray-300']">{{ result.draw.blue < 10 ? '0'+result.draw.blue : result.draw.blue }}</span>
                </div>
                <div class="flex justify-between text-xs md:text-sm text-gray-600">
                    <p>å‘½ä¸­çº¢çƒï¼š<span class="font-bold text-red-600">{{ result.matchedReds }}</span> ä¸ª</p>
                    <p>å‘½ä¸­è“çƒï¼š<span class="font-bold text-blue-600">{{ result.matchedBlues }}</span> ä¸ª</p>
                </div>
            </div>
        </div>
        <div class="overflow-x-auto rounded-xl border border-gray-200 shadow-sm">
            <table class="w-full text-center border-collapse text-sm md:text-base whitespace-nowrap">
                <thead>
                    <tr class="bg-gray-100 text-gray-700">
                        <th class="p-2 md:p-3 border-b font-medium">å¥–çº§</th>
                        <th class="p-2 md:p-3 border-b font-medium">å•æ³¨å¥–é‡‘</th>
                        <th class="p-2 md:p-3 border-b font-medium">ä¸­å¥–æ³¨æ•°</th>
                        <th class="p-2 md:p-3 border-b font-medium">å°è®¡é‡‘é¢</th>
                    </tr>
                </thead>
                <tbody>
                    <tr v-for="tier in 6" :key="tier" :class="result.prizeDetails[tier].count > 0 ? 'bg-yellow-50 font-bold' : 'text-gray-400'">
                        <td class="p-2 md:p-3 border-b">{{ ['ä¸€','äºŒ','ä¸‰','å››','äº”','å…­'][tier-1] }}ç­‰å¥–</td>
                        <td class="p-2 md:p-3 border-b">ï¿¥{{ formatMoney(result.draw.prizes[tier]) }}</td>
                        <td class="p-2 md:p-3 border-b text-blue-600">{{ formatMoney(result.prizeDetails[tier].count) }} æ³¨</td>
                        <td class="p-2 md:p-3 border-b text-red-600">ï¿¥{{ formatMoney(result.prizeDetails[tier].total) }}</td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="mt-6 text-center text-white p-4 md:p-6 rounded-xl shadow-inner" :class="result.totalMoney > 0 ? gradientClass : 'bg-gray-400'">
            <p class="text-sm md:text-lg opacity-90">æ€»è®¡ä¸­å¥–é‡‘é¢</p>
            <p class="text-3xl md:text-5xl font-black mt-1 md:mt-2 tracking-wider">ï¿¥ {{ formatMoney(result.totalMoney) }}</p>
            <div class="mt-3 md:mt-4 pt-3 md:pt-4 border-t border-white/30 text-xs md:text-sm flex flex-wrap justify-center gap-3 md:gap-6">
                <p>æŠ•å…¥: ï¿¥{{ formatMoney(totalBets * 2) }}</p>
                <p v-if="result.totalMoney > totalBets * 2" class="font-bold text-yellow-200">ç›ˆåˆ©: ï¿¥{{ formatMoney(result.totalMoney - totalBets * 2) }} ğŸ“ˆ</p>
                <p v-else-if="result.totalMoney > 0" class="font-bold text-pink-200">äºæŸ: ï¿¥{{ formatMoney(totalBets * 2 - result.totalMoney) }} ğŸ“‰</p>
                <p v-else class="font-bold text-gray-200">è¡€æœ¬æ— å½’ ğŸ“‰</p>
            </div>
        </div>
    </div>
</template>

<div id="app" class="max-w-4xl mx-auto space-y-4 md:space-y-6 pb-10">
    
    <!-- ä¼˜åŒ–åçš„æ•°æ®æºç®¡ç†åŒºï¼šè‡ªåŠ¨è¯»å–åœ¨çº¿ JS -->
    <div class="bg-white rounded-xl md:rounded-2xl shadow-md p-4 md:p-6 border-t-4 border-green-500 flex justify-between items-center">
        <div>
            <h2 class="text-lg md:text-xl font-bold text-gray-800 flex items-center gap-2">
                <span>ğŸ“¡ äº‘ç«¯å¼€å¥–æ•°æ®æº</span>
                <span v-if="db.length > 0" class="text-xs md:text-sm bg-green-100 text-green-700 px-2 py-1 md:px-3 rounded-full">å·²è‡ªåŠ¨åŠ è½½ {{ db.length }} æœŸ</span>
                <span v-else class="text-xs md:text-sm bg-red-100 text-red-700 px-2 py-1 md:px-3 rounded-full">æ‹‰å–å¤±è´¥æˆ–æ— æ•°æ®</span>
            </h2>
            <p class="text-xs text-gray-400 mt-1" v-if="db.length > 0">æœ€æ–°æœŸå·: {{ db[0].issue }} ({{ db[0].date }})</p>
        </div>
        
        <label class="cursor-pointer bg-green-50 text-green-600 border border-green-200 hover:bg-green-100 font-bold py-2 px-3 rounded-lg text-sm transition active:scale-95">
            æ‰‹åŠ¨æ›´æ–° TXT
            <input type="file" accept=".txt" @change="handleFileUpload">
        </label>
    </div>

    <!-- æ ¸å¿ƒè¾“å…¥ä¸è®¡ç®—åŒº -->
    <div class="bg-white rounded-xl md:rounded-2xl shadow-md p-4 md:p-6">
        <h1 class="text-2xl md:text-3xl font-extrabold text-center text-red-600 mb-4 md:mb-6 border-b pb-3 md:pb-4">å¤å¼æé€Ÿè®¡ç®—å™¨</h1>

        <div class="space-y-4">
            <div>
                <label class="block text-gray-700 font-bold mb-1 md:mb-2 text-sm md:text-base">çº¢çƒå·ç  (è‡³å°‘6ä¸ª):</label>
                <textarea v-model="inputReds" rows="2" class="w-full p-3 border border-red-300 rounded-lg focus:ring-2 focus:ring-red-500 outline-none text-base md:text-lg font-bold tracking-wider text-red-600 resize-none" placeholder="ä¾‹å¦‚: 01 05 12 16 22 28 30 31"></textarea>
                <div class="flex justify-between mt-1">
                    <span class="text-xs text-red-500" v-if="parsedReds.length > 0 && parsedReds.length < 6">âš ï¸ è‡³å°‘é€‰6ä¸ªçº¢çƒ</span>
                    <span class="text-xs text-gray-500" v-else>å·²é€‰ {{ parsedReds.length }} ä¸ªçº¢çƒ</span>
                </div>
            </div>

            <div>
                <label class="block text-gray-700 font-bold mb-1 md:mb-2 text-sm md:text-base">è“çƒå·ç  (è‡³å°‘1ä¸ª):</label>
                <input v-model="inputBlues" type="text" class="w-full p-3 border border-blue-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none text-base md:text-lg font-bold tracking-wider text-blue-600" placeholder="ä¾‹å¦‚: 03 12">
                <div class="flex justify-between mt-1">
                    <span class="text-xs text-red-500" v-if="parsedBlues.length === 0 && inputBlues">âš ï¸ è‡³å°‘éœ€è¦1ä¸ªè“çƒ</span>
                    <span class="text-xs text-gray-500" v-else>å·²é€‰ {{ parsedBlues.length }} ä¸ªè“çƒ</span>
                </div>
            </div>

            <div>
                <label class="block text-gray-700 font-bold mb-1 md:mb-2 text-sm md:text-base">æŒ‡å®šæœŸå·æŸ¥è¯¢ (ç•™ç©ºç®—æœ€æ–°ä¸€æœŸ):</label>
                <input v-model="targetIssue" type="number" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gray-500 outline-none text-base" placeholder="ä¾‹å¦‚: 2026021">
            </div>

            <button @click="calculatePrize" :disabled="!canCalculate" class="w-full bg-red-600 hover:bg-red-700 disabled:bg-gray-400 text-white font-bold py-3 md:py-4 rounded-xl shadow-lg transition duration-200 text-base md:text-lg flex justify-center items-center active:scale-95">
                <span v-if="!canCalculate">è¯·å®Œå–„å·ç åŠæ•°æ®æº</span>
                <span v-else>ç«‹å³è®¡ç®—ä¸­å¥–ç»“æœ ğŸš€</span>
            </button>
        </div>
    </div>

    <!-- ç»“æœå±•ç¤ºåŒº -->
    <div id="result-area" class="space-y-4 md:space-y-6 scroll-mt-4">
        <result-card 
            v-if="currentResult"
            title="ğŸ‰ æœ¬æœŸæŸ¥è¯¢ç»“æœ ğŸ‰"
            theme-class="border-yellow-400"
            gradient-class="bg-gradient-to-r from-red-500 to-red-600"
            :result="currentResult" 
            :parsed-reds="parsedReds" 
            :parsed-blues="parsedBlues" 
            :total-bets="totalBets">
        </result-card>

        <result-card 
            v-if="historyMaxResult && (!currentResult || historyMaxResult.draw.issue !== currentResult.draw.issue)"
            title="ğŸ‘‘ å†å²æ•°æ®ä¸­æœ€é«˜å¥–é‡‘æœŸå· ğŸ‘‘"
            theme-class="border-purple-500"
            gradient-class="bg-gradient-to-r from-purple-500 to-indigo-600"
            :result="historyMaxResult" 
            :parsed-reds="parsedReds" 
            :parsed-blues="parsedBlues" 
            :total-bets="totalBets">
        </result-card>
    </div>
</div>

<script>
const { createApp } = Vue;

function C(n, m) {
    if (m < 0 || m > n) return 0;
    if (m === 0 || m === n) return 1;
    let res = 1;
    for (let i = 1; i <= m; i++) {
        res = res * (n - i + 1) / i;
    }
    return res;
}

const ResultCard = {
    template: '#result-template',
    props: ['result', 'parsedReds', 'parsedBlues', 'totalBets', 'title', 'themeClass', 'gradientClass'],
    methods: {
        formatMoney(num) {
            return num.toLocaleString('zh-CN');
        }
    }
};

// å¤‡ç”¨å…œåº•æ•°æ®ï¼Œä¸‡ä¸€å¤–éƒ¨ JS æ²¡åŠ è½½æˆåŠŸï¼Œä¸è‡³äºç™½æ¿
const FALLBACK_DATA = `2026020 2026-02-24 01 13 14 21 24 30 02 13 24 01 30 21 14 381989060 2712273374 2 10000000 64 994080 974 3000 50504 200 1022416 10 9284458 5 7595784 5`;

createApp({
    components: {
        'result-card': ResultCard
    },
    data() {
        return {
            // ğŸŒŸ æ ¸å¿ƒä¿®æ”¹ï¼šä¼˜å…ˆè¯»å– window.SSQ_ONLINE_DATAï¼Œå¦‚æœæ²¡æœ‰åˆ™è¯»å–å…œåº•æ•°æ®
            rawData: typeof window.SSQ_ONLINE_DATA !== 'undefined' ? window.SSQ_ONLINE_DATA : FALLBACK_DATA,
            db: [],
            inputReds: '01 05 12 16 22 28 30 31', 
            inputBlues: '03 04 12',
            targetIssue: '',
            currentResult: null,
            historyMaxResult: null
        }
    },
    computed: {
        parsedReds() { return [...new Set(this.inputReds.split(/[\s,ï¼Œã€]+/).map(Number).filter(n => n >= 1 && n <= 33))].sort((a, b) => a - b); },
        parsedBlues() { return [...new Set(this.inputBlues.split(/[\s,ï¼Œã€]+/).map(Number).filter(n => n >= 1 && n <= 16))].sort((a, b) => a - b); },
        canCalculate() { return this.parsedReds.length >= 6 && this.parsedBlues.length >= 1 && this.db.length > 0; },
        totalBets() { return C(this.parsedReds.length, 6) * C(this.parsedBlues.length, 1); }
    },
    mounted() {
        this.parseTxtData();
    },
    methods: {
        handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (e) => {
                this.rawData = e.target.result;
                this.parseTxtData();
            };
            reader.readAsText(file);
        },
        parseTxtData() {
            if(!this.rawData) {
                this.db = [];
                return;
            }
            const lines = this.rawData.trim().split('\n').reverse();
            this.db = lines.map(line => {
                const cols = line.trim().split(/\s+/);
                if(cols.length < 29) return null;
                return {
                    issue: cols[0], date: cols[1],
                    reds: cols.slice(2, 8).map(Number), blue: Number(cols[8]),
                    prizes: {
                        1: Number(cols[18]), 2: Number(cols[20]), 3: Number(cols[22]), 
                        4: Number(cols[24]), 5: Number(cols[26]), 6: Number(cols[28])  
                    }
                };
            }).filter(item => item !== null);
        },
        calculateSingleDraw(draw) {
            const R = this.parsedReds.length;
            const B = this.parsedBlues.length;
            const m = this.parsedReds.filter(x => draw.reds.includes(x)).length;
            const n = this.parsedBlues.includes(draw.blue) ? 1 : 0;

            const calcTickets = (reqR, reqB) => C(m, reqR) * C(R - m, 6 - reqR) * C(n, reqB) * C(B - n, 1 - reqB);

            const details = {
                1: { count: calcTickets(6, 1) }, 2: { count: calcTickets(6, 0) },
                3: { count: calcTickets(5, 1) }, 4: { count: calcTickets(5, 0) + calcTickets(4, 1) },
                5: { count: calcTickets(4, 0) + calcTickets(3, 1) }, 6: { count: calcTickets(2, 1) + calcTickets(1, 1) + calcTickets(0, 1) }
            };

            let totalMoney = 0;
            for (let i = 1; i <= 6; i++) {
                details[i].total = details[i].count * draw.prizes[i];
                totalMoney += details[i].total;
            }
            return { draw, matchedReds: m, matchedBlues: n, prizeDetails: details, totalMoney };
        },
        calculatePrize() {
            let targetDraw = this.targetIssue.trim() ? this.db.find(d => d.issue === this.targetIssue.trim()) : this.db[0];
            if (!targetDraw) {
                alert(`æœªæ‰¾åˆ°æœŸå·ä¸º ${this.targetIssue} çš„è®°å½•ï¼`);
                return;
            }
            this.currentResult = this.calculateSingleDraw(targetDraw);

            let maxMoney = -1;
            let bestResult = null;
            for (const draw of this.db) {
                const res = this.calculateSingleDraw(draw);
                if (res.totalMoney > maxMoney) {
                    maxMoney = res.totalMoney;
                    bestResult = res;
                }
            }
            this.historyMaxResult = maxMoney > 0 ? bestResult : null;

            this.$nextTick(() => {
                document.getElementById('result-area').scrollIntoView({ behavior: 'smooth' });
            });
        }
    }
}).mount('#app')
</script>
</body>
</html>
