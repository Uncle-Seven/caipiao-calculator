<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>åŒè‰²çƒå¤å¼ä¸­å¥–æé€ŸæŸ¥è¯¢ç³»ç»Ÿ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <style>
        .ball {
            display: inline-flex; justify-content: center; align-items: center;
            border-radius: 50%; color: white; font-weight: bold;
        }
        .red-ball { background: radial-gradient(circle at 30% 30%, #ff6b6b, #c0392b); box-shadow: 0 2px 4px rgba(192,57,43,0.4); }
        .blue-ball { background: radial-gradient(circle at 30% 30%, #4facfe, #00f2fe); box-shadow: 0 2px 4px rgba(0,242,254,0.4); }
        input[type="file"] { display: none; }
        * { -webkit-tap-highlight-color: transparent; }
    </style>
</head>
<body class="bg-gray-100 min-h-screen p-2 sm:p-4 md:p-8 text-gray-800">

<!-- å®šä¹‰ Vue ç»„ä»¶æ¨¡æ¿ï¼šä¸­å¥–ç»“æœå¡ç‰‡ (ä¿æŒHTMLå¹²å‡€ä¸é‡å¤) -->
<template id="result-template">
    <div :class="['bg-white rounded-xl md:rounded-2xl shadow-md p-4 md:p-6 border-t-4', themeClass]">
        <h2 class="text-xl md:text-2xl font-bold text-center mb-4 md:mb-6 text-gray-800">{{ title }}</h2>
        
        <div class="grid md:grid-cols-2 gap-4 md:gap-6 mb-6">
            <!-- æŠ•æ³¨ä¿¡æ¯ -->
            <div class="bg-gray-50 p-3 md:p-4 rounded-xl border border-gray-200">
                <h3 class="text-sm md:text-base font-bold text-gray-600 mb-2 md:mb-3">æ‚¨çš„æŠ•æ³¨æ–¹æ¡ˆ</h3>
                <div class="flex flex-wrap gap-1.5 md:gap-2 mb-3">
                    <span v-for="r in parsedReds" class="ball red-ball w-7 h-7 md:w-9 md:h-9 text-xs md:text-sm">{{ r < 10 ? '0'+r : r }}</span>
                    <span v-for="b in parsedBlues" class="ball blue-ball w-7 h-7 md:w-9 md:h-9 text-xs md:text-sm">{{ b < 10 ? '0'+b : b }}</span>
                </div>
                <div class="flex justify-between text-xs md:text-sm text-gray-600">
                    <p>æ€»æ³¨æ•°ï¼š<span class="font-bold text-black">{{ formatMoney(totalBets) }}</span> æ³¨</p>
                    <p>æ€»æˆæœ¬ï¼š<span class="font-bold text-red-600">ï¿¥{{ formatMoney(totalBets * 2) }}</span></p>
                </div>
            </div>

            <!-- å¼€å¥–ä¿¡æ¯ -->
            <div class="bg-gray-50 p-3 md:p-4 rounded-xl border border-gray-200">
                <h3 class="text-sm md:text-base font-bold text-gray-600 mb-2 md:mb-3">
                    ç¬¬ <span class="text-red-600">{{ result.draw.issue }}</span> æœŸå¼€å¥– 
                    <span class="text-xs font-normal text-gray-400 block sm:inline">({{ result.draw.date }})</span>
                </h3>
                <div class="flex flex-wrap gap-1.5 md:gap-2 mb-3">
                    <span v-for="r in result.draw.reds" :class="['ball w-7 h-7 md:w-9 md:h-9 text-xs md:text-sm', parsedReds.includes(r) ? 'red-ball' : 'bg-gray-300']">{{ r < 10 ? '0'+r : r }}</span>
                    <span :class="['ball w-7 h-7 md:w-9 md:h-9 text-xs md:text-sm', parsedBlues.includes(result.draw.blue) ? 'blue-ball' : 'bg-gray-300']">{{ result.draw.blue < 10 ? '0'+result.draw.blue : result.draw.blue }}</span>
                </div>
                <div class="flex justify-between text-xs md:text-sm text-gray-600">
                    <p>å‘½ä¸­çº¢çƒï¼š<span class="font-bold text-red-600">{{ result.matchedReds }}</span> ä¸ª</p>
                    <p>å‘½ä¸­è“çƒï¼š<span class="font-bold text-blue-600">{{ result.matchedBlues }}</span> ä¸ª</p>
                </div>
            </div>
        </div>

        <!-- ä¸­å¥–æ˜ç»†è¡¨æ ¼ -->
        <div class="overflow-x-auto rounded-xl border border-gray-200 shadow-sm">
            <table class="w-full text-center border-collapse text-sm md:text-base whitespace-nowrap">
                <thead>
                    <tr class="bg-gray-100 text-gray-700">
                        <th class="p-2 md:p-3 border-b font-medium">å¥–çº§</th>
                        <th class="p-2 md:p-3 border-b font-medium">å•æ³¨å¥–é‡‘</th>
                        <th class="p-2 md:p-3 border-b font-medium">ä¸­å¥–æ³¨æ•°</th>
                        <th class="p-2 md:p-3 border-b font-medium">å°è®¡é‡‘é¢</th>
                    </tr>
                </thead>
                <tbody>
                    <tr v-for="tier in 6" :key="tier" :class="result.prizeDetails[tier].count > 0 ? 'bg-yellow-50 font-bold' : 'text-gray-400'">
                        <td class="p-2 md:p-3 border-b">{{ ['ä¸€','äºŒ','ä¸‰','å››','äº”','å…­'][tier-1] }}ç­‰å¥–</td>
                        <td class="p-2 md:p-3 border-b">ï¿¥{{ formatMoney(result.draw.prizes[tier]) }}</td>
                        <td class="p-2 md:p-3 border-b text-blue-600">{{ formatMoney(result.prizeDetails[tier].count) }} æ³¨</td>
                        <td class="p-2 md:p-3 border-b text-red-600">ï¿¥{{ formatMoney(result.prizeDetails[tier].total) }}</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- æœ€ç»ˆç›ˆäºè®¡ç®— -->
        <div class="mt-6 text-center text-white p-4 md:p-6 rounded-xl shadow-inner" :class="result.totalMoney > 0 ? gradientClass : 'bg-gray-400'">
            <p class="text-sm md:text-lg opacity-90">æ€»è®¡ä¸­å¥–é‡‘é¢</p>
            <p class="text-3xl md:text-5xl font-black mt-1 md:mt-2 tracking-wider">ï¿¥ {{ formatMoney(result.totalMoney) }}</p>
            <div class="mt-3 md:mt-4 pt-3 md:pt-4 border-t border-white/30 text-xs md:text-sm flex flex-wrap justify-center gap-3 md:gap-6">
                <p>æŠ•å…¥: ï¿¥{{ formatMoney(totalBets * 2) }}</p>
                <p v-if="result.totalMoney > totalBets * 2" class="font-bold text-yellow-200">ç›ˆåˆ©: ï¿¥{{ formatMoney(result.totalMoney - totalBets * 2) }} ğŸ“ˆ</p>
                <p v-else-if="result.totalMoney > 0" class="font-bold text-pink-200">äºæŸ: ï¿¥{{ formatMoney(totalBets * 2 - result.totalMoney) }} ğŸ“‰</p>
                <p v-else class="font-bold text-gray-200">è¡€æœ¬æ— å½’ ğŸ“‰</p>
            </div>
        </div>
    </div>
</template>

<!-- ä¸»ç¨‹åºåŒº -->
<div id="app" class="max-w-4xl mx-auto space-y-4 md:space-y-6 pb-10">
    
    <!-- æ•°æ®æºç®¡ç†åŒº -->
    <div class="bg-white rounded-xl md:rounded-2xl shadow-md p-4 md:p-6 border-t-4 border-indigo-500">
        <h2 class="text-lg md:text-xl font-bold text-gray-800 mb-3 md:mb-4 flex flex-wrap items-center gap-2">
            <span>ğŸ“¦ å¼€å¥–æ•°æ®æº</span>
            <span v-if="db.length > 0" class="ml-auto text-xs md:text-sm bg-green-100 text-green-700 px-2 py-1 md:px-3 md:py-1 rounded-full">å·²åŠ è½½ {{ db.length }} æœŸ</span>
            <span v-else class="ml-auto text-xs md:text-sm bg-red-100 text-red-700 px-2 py-1 md:px-3 md:py-1 rounded-full">æš‚æ— æœ‰æ•ˆæ•°æ®</span>
        </h2>
        
        <p class="text-xs md:text-sm text-gray-500 mb-3 md:mb-4 leading-relaxed">
            å¦‚éœ€æœ€æ–°æ•°æ®ï¼Œè¯·ç‚¹å‡» <a href="https://data.17500.cn/ssq_asc.txt" target="_blank" class="text-blue-500 underline font-bold">å®˜æ–¹æ•°æ®</a>ï¼Œå…¨é€‰å¤åˆ¶å¹¶ç²˜è´´åœ¨ä¸‹æ–¹ï¼Œæˆ–å¯¼å…¥txtæ–‡ä»¶ã€‚
        </p>

        <div class="flex flex-col md:flex-row gap-3">
            <textarea v-model="rawData" @input="parseTxtData" rows="3" class="w-full p-3 border border-indigo-200 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none text-xs text-gray-600 bg-gray-50 font-mono resize-none" placeholder="è¯·å°†æ•°æ®ç²˜è´´åˆ°è¿™é‡Œ..."></textarea>
            
            <div class="flex flex-row md:flex-col gap-2 shrink-0">
                <label class="flex-1 cursor-pointer bg-indigo-50 text-indigo-600 border border-indigo-200 hover:bg-indigo-100 font-bold py-2 px-3 md:px-4 rounded-lg text-center text-sm md:text-base flex items-center justify-center transition active:scale-95">
                    ğŸ“ å¯¼å…¥æ–‡ä»¶
                    <input type="file" accept=".txt" @change="handleFileUpload">
                </label>
                <button @click="loadDemoData" class="flex-1 bg-gray-50 text-gray-600 border border-gray-200 hover:bg-gray-100 font-bold py-2 px-3 md:px-4 rounded-lg text-sm md:text-base transition active:scale-95">
                    ğŸ”„ æ¼”ç¤ºæ•°æ®
                </button>
            </div>
        </div>
    </div>

    <!-- æ ¸å¿ƒè¾“å…¥ä¸è®¡ç®—åŒº -->
    <div class="bg-white rounded-xl md:rounded-2xl shadow-md p-4 md:p-6">
        <h1 class="text-2xl md:text-3xl font-extrabold text-center text-red-600 mb-4 md:mb-6 border-b pb-3 md:pb-4">å¤å¼ä¸­å¥–è®¡ç®—å™¨</h1>

        <div class="space-y-4">
            <div>
                <label class="block text-gray-700 font-bold mb-1 md:mb-2 text-sm md:text-base">çº¢çƒå·ç  (è‡³å°‘6ä¸ªï¼Œ1-33):</label>
                <textarea v-model="inputReds" rows="2" class="w-full p-3 border border-red-300 rounded-lg focus:ring-2 focus:ring-red-500 outline-none text-base md:text-lg font-bold tracking-wider text-red-600 resize-none" placeholder="ä¾‹å¦‚: 01 05 12 16 22 28 30 31"></textarea>
                <div class="flex justify-between mt-1">
                    <span class="text-xs text-red-500" v-if="parsedReds.length > 0 && parsedReds.length < 6">âš ï¸ çº¢çƒæ•°é‡ä¸è¶³6ä¸ª</span>
                    <span class="text-xs text-gray-500" v-else>å·²é€‰ {{ parsedReds.length }} ä¸ªçº¢çƒ</span>
                </div>
            </div>

            <div>
                <label class="block text-gray-700 font-bold mb-1 md:mb-2 text-sm md:text-base">è“çƒå·ç  (è‡³å°‘1ä¸ªï¼Œ1-16):</label>
                <input v-model="inputBlues" type="text" class="w-full p-3 border border-blue-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none text-base md:text-lg font-bold tracking-wider text-blue-600" placeholder="ä¾‹å¦‚: 03 12">
                <div class="flex justify-between mt-1">
                    <span class="text-xs text-red-500" v-if="parsedBlues.length === 0 && inputBlues">âš ï¸ è‡³å°‘éœ€è¦1ä¸ªè“çƒ</span>
                    <span class="text-xs text-gray-500" v-else>å·²é€‰ {{ parsedBlues.length }} ä¸ªè“çƒ</span>
                </div>
            </div>

            <div>
                <label class="block text-gray-700 font-bold mb-1 md:mb-2 text-sm md:text-base">æŒ‡å®šæœŸå· (ç•™ç©ºç®—æœ€æ–°ä¸€æœŸ):</label>
                <input v-model="targetIssue" type="number" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gray-500 outline-none text-base" placeholder="ä¾‹å¦‚: 2026021">
            </div>

            <button @click="calculatePrize" :disabled="!canCalculate" class="w-full bg-red-600 hover:bg-red-700 disabled:bg-gray-400 text-white font-bold py-3 md:py-4 rounded-xl shadow-lg transition duration-200 text-base md:text-lg flex justify-center items-center active:scale-95">
                <span v-if="!canCalculate">è¯·å®Œå–„å·ç åŠæ•°æ®æº</span>
                <span v-else>ç«‹å³è®¡ç®—ä¸­å¥–ç»“æœ ğŸš€</span>
            </button>
        </div>
    </div>

    <!-- ç»“æœå±•ç¤ºåŒº -->
    <div id="result-area" class="space-y-4 md:space-y-6 scroll-mt-4">
        
        <!-- æŒ‡å®šæœŸ / æœ€æ–°æœŸ ç»“æœ -->
        <result-card 
            v-if="currentResult"
            title="ğŸ‰ æœ¬æœŸæŸ¥è¯¢ç»“æœ ğŸ‰"
            theme-class="border-yellow-400"
            gradient-class="bg-gradient-to-r from-red-500 to-red-600"
            :result="currentResult" 
            :parsed-reds="parsedReds" 
            :parsed-blues="parsedBlues" 
            :total-bets="totalBets">
        </result-card>

        <!-- å†å²æœ€é«˜çºªå½•ç»“æœ (å¦‚æœå†å²æœ€é«˜åˆšå¥½ç­‰äºå½“å‰æœŸï¼Œåˆ™ä¸é‡å¤æ˜¾ç¤º) -->
        <result-card 
            v-if="historyMaxResult && (!currentResult || historyMaxResult.draw.issue !== currentResult.draw.issue)"
            title="ğŸ‘‘ å†å²æ•°æ®ä¸­æœ€é«˜å¥–é‡‘æœŸå· ğŸ‘‘"
            theme-class="border-purple-500"
            gradient-class="bg-gradient-to-r from-purple-500 to-indigo-600"
            :result="historyMaxResult" 
            :parsed-reds="parsedReds" 
            :parsed-blues="parsedBlues" 
            :total-bets="totalBets">
        </result-card>

    </div>
</div>

<script>
const { createApp } = Vue;

// ç»„åˆæ•°å­¦å…¬å¼
function C(n, m) {
    if (m < 0 || m > n) return 0;
    if (m === 0 || m === n) return 1;
    let res = 1;
    for (let i = 1; i <= m; i++) {
        res = res * (n - i + 1) / i;
    }
    return res;
}

// æå–çš„Vueç»„ä»¶ï¼šç»“æœå¡ç‰‡
const ResultCard = {
    template: '#result-template',
    props: ['result', 'parsedReds', 'parsedBlues', 'totalBets', 'title', 'themeClass', 'gradientClass'],
    methods: {
        formatMoney(num) {
            return num.toLocaleString('zh-CN');
        }
    }
};

const DEMO_DATA = `2026020 2026-02-24 01 13 14 21 24 30 02 13 24 01 30 21 14 381989060 2712273374 2 10000000 64 994080 974 3000 50504 200 1022416 10 9284458 5 7595784 5\n2026021 2026-02-26 03 13 25 26 30 31 04 30 26 13 31 25 03 351619166 2682273374 6 7076614 113 441050 1114 3000 60760 200 1146956 10 8538823 5 8067454 5\n2026019 2026-02-22 01 05 12 16 22 30 12 351619166 2682273374 2 5000000 113 441050 1114 3000 60760 200 1146956 10 8538823 5 8067454 5`; // æ·»åŠ äº†ä¸€æ¡æ¨¡æ‹Ÿä¸­å¥–çš„å‡æ•°æ®ç”¨äºæµ‹è¯•

createApp({
    components: {
        'result-card': ResultCard
    },
    data() {
        return {
            rawData: DEMO_DATA,
            db: [],
            inputReds: '01 05 12 16 22 28 30 31', 
            inputBlues: '03 04 12',
            targetIssue: '',
            currentResult: null,   // æŒ‡å®šæœŸ/æœ€æ–°æœŸçš„ç»“æœ
            historyMaxResult: null // å†å²æœ€é«˜ç»“æœ
        }
    },
    computed: {
        parsedReds() {
            return [...new Set(this.inputReds.split(/[\s,ï¼Œã€]+/).map(Number).filter(n => n >= 1 && n <= 33))].sort((a, b) => a - b);
        },
        parsedBlues() {
            return [...new Set(this.inputBlues.split(/[\s,ï¼Œã€]+/).map(Number).filter(n => n >= 1 && n <= 16))].sort((a, b) => a - b);
        },
        canCalculate() {
            return this.parsedReds.length >= 6 && this.parsedBlues.length >= 1 && this.db.length > 0;
        },
        totalBets() {
            return C(this.parsedReds.length, 6) * C(this.parsedBlues.length, 1);
        }
    },
    mounted() {
        this.parseTxtData();
    },
    methods: {
        loadDemoData() {
            this.rawData = DEMO_DATA;
            this.parseTxtData();
            this.currentResult = null;
            this.historyMaxResult = null;
        },
        handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (e) => {
                this.rawData = e.target.result;
                this.parseTxtData();
            };
            reader.readAsText(file);
        },
        parseTxtData() {
            if(!this.rawData) {
                this.db = [];
                return;
            }
            const lines = this.rawData.trim().split('\n').reverse(); // æœ€æ–°æœŸåœ¨å‰
            this.db = lines.map(line => {
                const cols = line.trim().split(/\s+/);
                if(cols.length < 29) return null;
                return {
                    issue: cols[0],
                    date: cols[1],
                    reds: cols.slice(2, 8).map(Number),
                    blue: Number(cols[8]),
                    prizes: {
                        1: Number(cols[18]), 
                        2: Number(cols[20]), 
                        3: Number(cols[22]), 
                        4: Number(cols[24]), 
                        5: Number(cols[26]), 
                        6: Number(cols[28])  
                    }
                };
            }).filter(item => item !== null);
        },
        
        // æ ¸å¿ƒæŠ½ç¦»ï¼šè®¡ç®—ä»»æ„ä¸€æœŸçš„ä¸­å¥–æƒ…å†µ
        calculateSingleDraw(draw) {
            const R = this.parsedReds.length;
            const B = this.parsedBlues.length;
            
            const m = this.parsedReds.filter(x => draw.reds.includes(x)).length;
            const n = this.parsedBlues.includes(draw.blue) ? 1 : 0;

            const calcTickets = (reqR, reqB) => {
                return C(m, reqR) * C(R - m, 6 - reqR) * C(n, reqB) * C(B - n, 1 - reqB);
            };

            const details = {
                1: { count: calcTickets(6, 1) },
                2: { count: calcTickets(6, 0) },
                3: { count: calcTickets(5, 1) },
                4: { count: calcTickets(5, 0) + calcTickets(4, 1) },
                5: { count: calcTickets(4, 0) + calcTickets(3, 1) },
                6: { count: calcTickets(2, 1) + calcTickets(1, 1) + calcTickets(0, 1) }
            };

            let totalMoney = 0;
            for (let i = 1; i <= 6; i++) {
                details[i].total = details[i].count * draw.prizes[i];
                totalMoney += details[i].total;
            }

            return { draw, matchedReds: m, matchedBlues: n, prizeDetails: details, totalMoney };
        },

        calculatePrize() {
            // 1. è®¡ç®—æŒ‡å®šæœŸ / æœ€æ–°æœŸ
            let targetDraw = this.targetIssue.trim() 
                ? this.db.find(d => d.issue === this.targetIssue.trim())
                : this.db[0];

            if (!targetDraw) {
                alert(`æœªæ‰¾åˆ°æœŸå·ä¸º ${this.targetIssue} çš„å¼€å¥–è®°å½•ï¼`);
                return;
            }
            this.currentResult = this.calculateSingleDraw(targetDraw);

            // 2. ç¬é—´éå†æ•´ä¸ª dbï¼Œå¯»æ‰¾å†å²æœ€é«˜å¥–é‡‘
            let maxMoney = -1;
            let bestResult = null;
            
            for (const draw of this.db) {
                const res = this.calculateSingleDraw(draw);
                if (res.totalMoney > maxMoney) {
                    maxMoney = res.totalMoney;
                    bestResult = res;
                }
            }
            
            // åªæœ‰å†å²çºªå½•å¥–é‡‘å¤§äº 0ï¼Œæ‰å±•ç¤ºå†å²æœ€é«˜å¡ç‰‡ (é¿å…å…¨æ²¡ä¸­å¥–æ˜¾ç¤ºä¸¤ä¸ªè¡€æœ¬æ— å½’)
            if (maxMoney > 0) {
                this.historyMaxResult = bestResult;
            } else {
                this.historyMaxResult = null; // æ‰€æœ‰å†å²æœŸéƒ½æ²¡ä¸­å¥–
            }

            // ç§»åŠ¨ç«¯ä½“éªŒä¼˜åŒ–ï¼šå¹³æ»‘æ»šåŠ¨åˆ°ç»“æœåŒºåŸŸ
            this.$nextTick(() => {
                document.getElementById('result-area').scrollIntoView({ behavior: 'smooth' });
            });
        }
    }
}).mount('#app')
</script>
</body>
</html>